<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Professor Noli Brazil" />

<meta name="date" content="2024-06-03" />

<title>Regression Trees</title>

<script src="site_libs/header-attrs-2.22/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GEO 200CN: Spring 2024</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="hw_guidelines.html">Assignment Guidelines</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="eda.html">Exploratory Data Analysis</a>
    </li>
    <li>
      <a href="inference.html">Statistical Inference</a>
    </li>
    <li>
      <a href="hypothesis.html">Hypothesis Testing</a>
    </li>
    <li>
      <a href="linearregression.html">Linear Regression</a>
    </li>
    <li>
      <a href="linearregression2.html">More Linear Regression</a>
    </li>
    <li>
      <a href="logistic.html">Logistic Regression</a>
    </li>
    <li>
      <a href="introspatial.html">Intro to Spatial Data</a>
    </li>
    <li>
      <a href="pointpatterns.html">Point Pattern Analysis</a>
    </li>
    <li>
      <a href="spatialautocorrelation.html">Spatial Autocorrelation</a>
    </li>
    <li>
      <a href="spatialreg.html">Spatial Regression</a>
    </li>
    <li>
      <a href="prediction.html">Prediction Modelling</a>
    </li>
    <li>
      <a href="variableselection.html">Variable Selection</a>
    </li>
    <li>
      <a href="interpolation.html">Spatial Interpolation</a>
    </li>
    <li>
      <a href="kriging.html">Kriging</a>
    </li>
    <li>
      <a href="regtrees.html">Regression Trees</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tips.html">R Tips</a>
    </li>
    <li>
      <a href="data_wrangling.html">Data Wrangling</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Regression Trees</h1>
<h3 class="subtitle"><font size="4">GEO 200CN - Quantitative
Geography</font></h3>
<h4 class="author">Professor Noli Brazil</h4>
<h4 class="date">June 3, 2024</h4>

</div>


<style>
p.comment {
background-color: #DBDBDB;
padding: 10px;
border: 1px solid black;
margin-left: 25px;
border-radius: 5px;
font-style: normal;
}

.figure {
   margin-top: 20px;
   margin-bottom: 20px;
}

h1.title {
  font-weight: bold;
  font-family: Arial;  
}

h2.title {
  font-family: Arial;  
}

</style>
<style type="text/css">
#TOC {
  font-size: 13px;
  font-family: Arial;
}
</style>
<p><br />
</p>
<p>This lab guide goes through the use of regression trees to make
spatial predictions. It follows closely the material presented in ISLR
Ch. 8. The objectives of this lab guide are as follows</p>
<ol style="list-style-type: decimal">
<li>Learn how to run classification trees</li>
<li>Learn how to prune classification trees</li>
<li>Learn how to run regression and classification random forest
models</li>
<li>Learn how to make predictions using a random forest model</li>
</ol>
<p>To achieve these objectives, you will be applying regression tree
methods in <a href="https://rspatial.org/sdm">species distribution
modelling</a> or ecological niche modeling. The objective in species
distribution modelling is to predict the entire range of a species based
on a set of locations where it has been observed. In this lab guide, we
use the hominid species Imaginus magnapedum (also known under the
vernacular names of “bigfoot” and “sasquatch”). This species is so hard
to find (at least by scientists) that its very existence is commonly
denied by the mainstream media! For more information about this
controversy, see the article by Lozier, Aniello and Hickerson: <a
href="http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2699.2009.02152.x/abstract">Predicting
the distribution of Sasquatch in western North America: anything goes
with ecological niche modelling</a>. Note that much of this lab guide
has been adapted from <a href="https://rspatial.org/">Spatial Data
Science</a>.</p>
<div style="margin-bottom:25px;">

</div>
<div id="installing-and-loading-packages" class="section level2">
<h2><strong>Installing and loading packages</strong></h2>
<p><br />
</p>
<p>We’ll be using several new packages in this lab guide. First, install
them</p>
<pre class="r"><code>install.packages(c(&quot;tree&quot;, &quot;randomForest&quot;, &quot;geodata&quot;, &quot;predicts&quot;))</code></pre>
<p>Second, load these packages and the others we will need for executing
the commands in this lab guide.</p>
<pre class="r"><code>library(tree)
library(randomForest)
library(geodata)
library(predicts)
library(tidyverse)
library(terra)
library(rspat)</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="bringing-in-the-data" class="section level2">
<h2><strong>Bringing in the data</strong></h2>
<p><br />
</p>
<p>The research objectives are to find out</p>
<ol style="list-style-type: decimal">
<li>What the complete range of the bigfoot species might be.</li>
<li>How good (general) our model is by predicting the range of the
Eastern bigfoot sub-species, with data from the Western
sub-species.</li>
<li>How good (general) our model is by predicting into the future.</li>
</ol>
<div style="margin-bottom:25px;">

</div>
<div id="observations" class="section level3">
<h3><strong>Observations</strong></h3>
<p><br />
</p>
<p>First bring in the bigfoot location data <em>bigfoot</em> from the
<strong>rspat</strong> package.</p>
<pre class="r"><code>bf &lt;- spat_data(&quot;bigfoot&quot;)</code></pre>
<p>What kind of object is this? And how many cases and variables are we
working with?</p>
<pre class="r"><code>class(bf)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<pre class="r"><code>dim(bf)</code></pre>
<pre><code>## [1] 3092    3</code></pre>
<pre class="r"><code>head(bf)</code></pre>
<pre><code>##         lon      lat Class
## 1 -142.9000 61.50000     A
## 2 -132.7982 55.18720     A
## 3 -132.8202 55.20350     A
## 4 -141.5667 62.93750     A
## 5 -149.7853 61.05950     A
## 6 -141.3165 62.77335     A</code></pre>
<p>These data show the latitude and longitude information of the known
locations of bigfoot sightings. Let’s plot where these fellas like to
roam. We’ll also add country borders for Canada, Mexico and the United
States taken from the <strong>geodata</strong> package.</p>
<pre class="r"><code>plot(bf[,1:2], cex=0.5, col=&#39;red&#39;)

wrld &lt;- geodata::world(path=&quot;.&quot;)
class(wrld)</code></pre>
<pre><code>## [1] &quot;SpatVector&quot;
## attr(,&quot;package&quot;)
## [1] &quot;terra&quot;</code></pre>
<pre class="r"><code>bnds &lt;- wrld[wrld$NAME_0 %in% c(&quot;Canada&quot;, &quot;Mexico&quot;, &quot;United States&quot;), ]
class(bnds)</code></pre>
<pre><code>## [1] &quot;SpatVector&quot;
## attr(,&quot;package&quot;)
## [1] &quot;terra&quot;</code></pre>
<pre class="r"><code>lines(bnds)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
<p>So they are in Canada and in the United States, but no reports from
Mexico…so far.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="predictor-variables" class="section level3">
<h3><strong>Predictor variables</strong></h3>
<p><br />
</p>
<p>We want to predict bigfoot locations, so we need predictors. The main
predictors typically used in species distribution modeling are climate
data. Specifically, we use <a
href="https://pubs.usgs.gov/ds/691/ds691.pdf">‘bioclimatic
variables’</a>. A record layout of the variables can be found <a
href="https://www.worldclim.org/data/bioclim.html">here</a>. Here we
used a spatial resolution of 10 minutes (one sixth of a degree). That is
relatively coarse but it makes the download and processing faster. We’ll
bring this data in from the package <strong>geodata</strong>.</p>
<pre class="r"><code>wc &lt;- geodata::worldclim_global(&quot;bio&quot;, res=10, &quot;.&quot;)
class(wc)</code></pre>
<pre><code>## [1] &quot;SpatRaster&quot;
## attr(,&quot;package&quot;)
## [1] &quot;terra&quot;</code></pre>
<p>What does these data look like? Plot the variables <em>bio1</em>
(Annual Mean Temperature) and <em>bio12</em> (Annual Precipitation) for
the world.</p>
<pre class="r"><code>plot(wc[[c(1, 12)]], nr=2)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p>Now extract climate data for the locations of our observations. That
is, get data about the climate where the species have been spotted. We
use the <code>extract()</code> function from the package
<strong>terra</strong>.</p>
<pre class="r"><code>bfc &lt;- terra::extract(wc, bf[,1:2])
head(bfc, 3)</code></pre>
<pre><code>##   ID wc2.1_10m_bio_1 wc2.1_10m_bio_2 wc2.1_10m_bio_3 wc2.1_10m_bio_4
## 1  1       -1.832979       12.504708        28.95899       1152.4308
## 2  2        6.360650        5.865935        32.27475        462.5731
## 3  3        6.360650        5.865935        32.27475        462.5731
##   wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7 wc2.1_10m_bio_8
## 1        20.34075      -22.840000        43.18075        5.327750
## 2        16.65505       -1.519947        18.17500        3.964495
## 3        16.65505       -1.519947        18.17500        3.964495
##   wc2.1_10m_bio_9 wc2.1_10m_bio_10 wc2.1_10m_bio_11 wc2.1_10m_bio_12
## 1      -0.6887083         11.80792       -16.038542              991
## 2      10.4428196         12.28183         1.467686             3079
## 3      10.4428196         12.28183         1.467686             3079
##   wc2.1_10m_bio_13 wc2.1_10m_bio_14 wc2.1_10m_bio_15 wc2.1_10m_bio_16
## 1              120               42         31.32536              337
## 2              448              141         35.27518             1127
## 3              448              141         35.27518             1127
##   wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19
## 1              157              288              216
## 2              468              630              873
## 3              468              630              873</code></pre>
<p>We remove the first column with the ID that we do not need.</p>
<pre class="r"><code>bfc &lt;- bfc %&gt;%
        dplyr::select(-ID)</code></pre>
<p>Now we can plot the species’ distribution in a part of the
environmental space. For example, here is a plot of temperature vs
rainfall of sites where Bigfoot was observed.</p>
<pre class="r"><code>plot(bfc[ ,&quot;wc2.1_10m_bio_1&quot;], bfc[, &quot;wc2.1_10m_bio_12&quot;], col=&quot;red&quot;,
        xlab=&quot;Annual mean temperature (°C)&quot;, ylab=&quot;Annual precipitation (mm)&quot;)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="background-data" class="section level3">
<h3><strong>Background data</strong></h3>
<p><br />
</p>
<p>The dataset <em>bf</em> gives us data for bigfoot sightings. The
dataset <em>bfc</em> gives us the climate data for the locations of
these sightings. But, in order to build a prediction model, we also need
the locations and their climate data for where bigfoot was <em>not
observed</em>. But we do not have data from a systematic survey that
determined both presence and absence. We have presence-only data.</p>
<p>The common trick to deal with this is to not model presence versus
absence, but presence versus a ‘random expectation’. This random
expectation (also referred to as ‘background’, or ‘random-absence’ data)
is what you would get if the species had no preference for any of the
predictor variables.</p>
<p>There is not much point in taking absence data from very far away
(tropical Africa or Antarctica). Typically they are taken from more or
less the entire study area for which we have presence data. Our study
region is North America. So, you create a set of random climate
observations from within the area of North America where bigfoot
observations have been made.</p>
<p>To do so, we first get the extent of all points using the function
<code>ext()</code>. Note that we have to use <code>vect()</code> from
<strong>terra</strong> to transform <em>bf</em> into a
<em>SpatVector</em>. We add a little buffer to the extent.</p>
<pre class="r"><code>#measures extent of area for bigfoot observations
ext_bf &lt;- ext(vect(bf[, 1:2])) + 1
ext_bf</code></pre>
<pre><code>## SpatExtent : -157.75, -63.4627, 24.141, 70.5 (xmin, xmax, ymin, ymax)</code></pre>
<p>And then we take 5,000 random samples (excluding <em>NA</em> cells)
from <em>SpatExtent</em> <em>ext_bf</em>, by using it as a “window”
(blacking out all other areas) on the climate <em>SpatRaster</em>
<em>wc</em>.</p>
<pre class="r"><code>#set seed for reproducibility since we are random sampling
set.seed(0)
window(wc) &lt;- ext_bf
#takes a 5000 random samples from wc within the extent e for bigfoot observations
bg &lt;- spatSample(wc, 5000, &quot;random&quot;, na.rm=TRUE, xy=TRUE)
dim(bg)</code></pre>
<pre><code>## [1] 5000   21</code></pre>
<pre class="r"><code>#5000 random points with climate variables
head(bg)</code></pre>
<pre><code>##           x        y wc2.1_10m_bio_1 wc2.1_10m_bio_2 wc2.1_10m_bio_3
## 1  -99.2500 66.75000     -13.2934895        7.870646        14.96619
## 2 -106.0833 42.08333       5.6722708       14.530958        36.82943
## 3 -111.9167 46.58333       6.7605939       14.135854        35.23372
## 4 -106.9167 54.75000       0.4086979       11.528605        24.43290
## 5 -118.2500 67.08333      -9.1363859        8.185354        16.34505
## 6 -111.2500 38.91667       8.4194584       15.997125        38.84047
##   wc2.1_10m_bio_4 wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7
## 1       1638.6833        15.42850       -37.16100        52.58950
## 2        894.3715        27.86600       -11.58875        39.45475
## 3        927.7927        28.14375       -11.97650        40.12025
## 4       1290.1088        22.55225       -24.63250        47.18475
## 5       1567.0846        17.46575       -32.61275        50.07850
## 6        904.0610        30.49050       -10.69625        41.18675
##   wc2.1_10m_bio_8 wc2.1_10m_bio_9 wc2.1_10m_bio_10 wc2.1_10m_bio_11
## 1        6.484917      -31.617332         7.518209        -31.76942
## 2        9.226916       -4.839750        17.168291         -4.83975
## 3       15.638333       -4.921750        18.186209         -4.92175
## 4       15.417084      -13.864500        15.417084        -16.31392
## 5        8.609292      -21.353209        10.573625        -27.49783
## 6       19.076958        3.179209        19.812834         -2.50475
##   wc2.1_10m_bio_12 wc2.1_10m_bio_13 wc2.1_10m_bio_14 wc2.1_10m_bio_15
## 1              171               33                4         70.29919
## 2              288               42               13         38.78144
## 3              293               48                9         53.40759
## 4              471               86               16         58.32499
## 5              223               43                7         61.21693
## 6              228               28               11         32.40370
##   wc2.1_10m_bio_16 wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19
## 1               90               13               78               13
## 2              112               41               90               41
## 3              129               35              115               35
## 4              220               53              220               56
## 5              108               27               93               29
## 6               83               40               72               44</code></pre>
<p>Above, with <code>spatSample()</code>, we used the argument
<code>xy=TRUE</code> to be able to show were these points are from.</p>
<pre class="r"><code>plot(bg[, c(&quot;x&quot;, &quot;y&quot;)])</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
<p>But we otherwise do not need them so we remove them.</p>
<pre class="r"><code>bg &lt;- bg[, -c(1:2)]</code></pre>
<p>We can now compare the climate of the presence and background points,
for example, for temperature and rainfall</p>
<pre class="r"><code>plot(bg[,1], bg[,12], xlab=&quot;Annual mean temperature (°C)&quot;,
          ylab=&quot;Annual precipitation (mm)&quot;, cex=.8)
points(bfc[,1], bfc[,12], col=&quot;red&quot;, cex=.6, pch=&quot;+&quot;)
legend(&quot;topleft&quot;, c(&quot;observed&quot;, &quot;background&quot;), col=c(&quot;red&quot;, &quot;black&quot;), pch=c(&quot;+&quot;, &quot;o&quot;), pt.cex=c(.6, .8))</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
<p>So we see that while Bigfoot is widespread, it is not common in cold
areas, nor in hot and dry areas.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="east-vs-west" class="section level3">
<h3><strong>East vs West</strong></h3>
<p><br />
</p>
<p>Now we have the data to fit a model. But let’s split the data into
East (greater than -102 longitude) and West. In this case, we may
believe Western and Eastern bigfoots are actually different, albeit
related, sub-species (for example, the Eastern Sasquatch is darker and
less hairy). We are going to fit the model using Western data and then
see if it predicts well for the Eastern data.</p>
<pre class="r"><code>#eastern points
bfe &lt;- bfc[bf[,1] &gt; -102, ]
#western points
bfw &lt;- bfc[bf[,1] &lt;= -102, ]</code></pre>
<p>And now we combine the presence (“1”) with the background (“0”) data
(We use the same background data for both subspecies) for the western
and eastern portions of North America, separately. Our predictive models
will be based on the western dataset.</p>
<pre class="r"><code>dw &lt;- rbind(cbind(pa=1, bfw), cbind(pa=0, bg))
de &lt;- rbind(cbind(pa=1, bfe), cbind(pa=0, bg))
dw &lt;- data.frame(dw)
de &lt;- data.frame(na.omit(de))
dim(dw)</code></pre>
<pre><code>## [1] 6224   20</code></pre>
<pre class="r"><code>dim(de)</code></pre>
<pre><code>## [1] 6866   20</code></pre>
<p>Now, we are ready. Let’s run some regression trees!!</p>
<div style="margin-bottom:25px;">

</div>
</div>
</div>
<div id="classification-trees" class="section level2">
<h2><strong>Classification trees</strong></h2>
<p><br />
</p>
<p>Our response variable is whether bigfoot is located in a particular
location (Yes) or not (No). We can use a classification method to
predict this binary variable. Here, we use a Classification Tree (CART),
which is discussed on page 311 in ISLR. To run a CART in R, we’ll need
to convert the (0,1) numeric indicator <em>pa</em> into a new (No, Yes)
factor variable we’ll name <em>fpa</em>.</p>
<pre class="r"><code>dw$fpa &lt;- as.factor(ifelse(dw$pa == 1, &quot;Yes&quot;, &quot;No&quot;))</code></pre>
<p>Use the <code>tree()</code> function in the <strong>tree</strong>
package to run a CART. The syntax of the function is similar to
<code>lm()</code> and other linear regression modelling functions we’ve
used extensively in this class. Note that we take out the (0,1)
indicator from the dataset using the function <code>select()</code> when
we run the model. Also note that there is another package in R that runs
regression trees, <strong>rpart</strong>, that many <a
href="https://daviddalpiaz.github.io/r4sl/trees.html#rpart-package">prefer</a>
over <strong>tree</strong> since its functions provide better
visualizations, among a few advantages. We go with <strong>tree</strong>
to follow ISLR (see pages 323-331).</p>
<pre class="r"><code>#use the western data in all the predictor columns with the climate except &quot;pa&quot; which is the response variable
cart1 &lt;- tree(fpa~., data=dplyr::select(dw,-pa))</code></pre>
<p>Here is a summary of the results.</p>
<pre class="r"><code>summary(cart1)</code></pre>
<pre><code>## 
## Classification tree:
## tree(formula = fpa ~ ., data = dplyr::select(dw, -pa))
## Variables actually used in tree construction:
## [1] &quot;wc2.1_10m_bio_4&quot;  &quot;wc2.1_10m_bio_10&quot; &quot;wc2.1_10m_bio_15&quot; &quot;wc2.1_10m_bio_3&quot; 
## [5] &quot;wc2.1_10m_bio_19&quot; &quot;wc2.1_10m_bio_18&quot; &quot;wc2.1_10m_bio_16&quot; &quot;wc2.1_10m_bio_12&quot;
## Number of terminal nodes:  10 
## Residual mean deviance:  0.4149 = 2578 / 6214 
## Misclassification error rate: 0.09512 = 592 / 6224</code></pre>
<p>The misclassification error rate is the training error rate, which is
around 10%. And here we plot the decision tree diagram, like the one
shown in Figure 8.6 in ISLR, which they describe in detail on pages
312-314.</p>
<pre class="r"><code>plot(cart1, main=&quot;Classification Tree&quot;)
text(cart1, cex=.8, digits=1)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-21-1.png" /><!-- --></p>
<p><br></p>
<p class="comment">
<strong>Question 1</strong>: Which variable is the most important
indicator of where our species might be located?
</p>
<p class="comment">
<strong>Question 2</strong>: Describe the conditions under which you are
likely to find our species?
</p>
<p><br></p>
<div style="margin-bottom:25px;">

</div>
<div id="tree-pruning" class="section level3">
<h3><strong>Tree Pruning</strong></h3>
<p><br />
</p>
<p>Next, we consider whether pruning the tree might lead to improved
results. Pruning is described in ISLR starting on page 307. The
algorithm is located on page 309. The key step is step 3, which
describes using k-fold cross validation to find the best tuning
parameter alpha, which dictates the number of terminal nodes of the best
fit tree. The function <code>cv.tree()</code> performs cross-validation
in order to determine the optimal level of tree complexity. Plug in the
big tree <em>cart1</em> produced by <code>tree()</code> in the section
above followed by <code>FUN = prune.misclass</code>, which indicates
that we want the classification error rate to guide the cross-validation
and pruning process. We set the seed for reproducibility.</p>
<pre class="r"><code>#kfold cuts the fold in random so set a seed.
set.seed(123)
cv.cart &lt;- cv.tree(cart1, FUN = prune.misclass)</code></pre>
<p>Let’s see what we get</p>
<pre class="r"><code>names(cv.cart)</code></pre>
<pre><code>## [1] &quot;size&quot;   &quot;dev&quot;    &quot;k&quot;      &quot;method&quot;</code></pre>
<p>and their values</p>
<pre class="r"><code>cv.cart</code></pre>
<pre><code>## $size
## [1] 10  7  5  4  1
## 
## $dev
## [1]  632  632  621  640 1203
## 
## $k
## [1]     -Inf   0.0000   9.0000  27.0000 195.6667
## 
## $method
## [1] &quot;misclass&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;prune&quot;         &quot;tree.sequence&quot;</code></pre>
<p>Note that, despite the name, <em>dev</em> corresponds to the
cross-validation error rate in this instance. The results under
<em>size</em> give the number of terminal nodes (size of the tree). The
tree with five terminal nodes (see <em>size</em>) results in the lowest
cross-validation error rate, with 621 cross-validation errors (see
<em>dev</em>). We plot the error rate as a function of the size.</p>
<pre class="r"><code>plot(cv.cart$size, cv.cart$dev, type = &quot;b&quot;)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-25-1.png" /><!-- --></p>
<p>Let’s be parsimonious and choose 5 as the best fit tree. We then
apply the <code>prune.misclass()</code> function in order to prune the
tree to obtain the five-node tree.</p>
<pre class="r"><code>prune.cart &lt;- prune.misclass(cart1, best = 5)</code></pre>
<p>And now the decision tree diagram</p>
<pre class="r"><code>plot(prune.cart, main=&quot;Regression Tree&quot;)
text(prune.cart, cex=.8, digits=1)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-27-1.png" /><!-- --></p>
<p>Differ much from the tree we got from <em>cart1</em>?</p>
<div style="margin-bottom:25px;">

</div>
</div>
</div>
<div id="random-forest" class="section level2">
<h2><strong>Random Forest</strong></h2>
<p><br />
</p>
<p>CART gives us a nice result to look at that can be easily
interpreted. But the approach suffers from high variance (meaning that
the model will be over-fit, it is different each time a somewhat
different datasets are used). Random Forest does not have that problem
as much. The method, which is an extension of Bagging, is discussed
starting on page 319 in ISLR.</p>
<div style="margin-bottom:25px;">

</div>
<div id="classification" class="section level3">
<h3><strong>Classification</strong></h3>
<p><br />
</p>
<p>We fit the Random Forest model using the function
<code>randomForest()</code> from the package
<strong>randomForest</strong>.</p>
<pre class="r"><code>#use the western data in all the predictor columns with the climate except &quot;pa&quot; which is the response variable
crf &lt;- randomForest(fpa~., data=dplyr::select(dw,-pa))
crf</code></pre>
<pre><code>## 
## Call:
##  randomForest(formula = fpa ~ ., data = dplyr::select(dw, -pa)) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 4
## 
##         OOB estimate of  error rate: 7.18%
## Confusion matrix:
##       No Yes class.error
## No  4797 203   0.0406000
## Yes  244 980   0.1993464</code></pre>
<p>The variable importance plot shows which variables are most important
in fitting the model. Variable importance is described in ISLR on page
319. The plot is generated by randomizing each predictor variable one by
one and then computing the decline in model prediction.</p>
<pre class="r"><code>varImpPlot(crf)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-29-1.png" /><!-- --></p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="regression" class="section level3">
<h3><strong>Regression</strong></h3>
<p><br />
</p>
<p>In the above sections, we’ve modelled bigfoot locations from a
classification perspective. But, we can also use regression. In this
case, by using a (0,1) numeric variable as the response, we are
modelling the probability that bigfoot is located in a location. We
still use the <code>randomForest()</code> function to run a Random
Forest regression model.</p>
<p>Note that there is an important parameter that differentiates Random
Forests from regular bagging (page 319 in ISLR talks about this
parameter). In the <code>randomForest()</code> function, this parameter
is designated by the argument <code>mtry =</code>. We did not specify
<code>mtry =</code> above, and thus took whatever the default is.</p>
<p>Instead of the default, we can instead find the best value for this
parameter by using the function <code>tuneRF()</code>.</p>
<pre class="r"><code>trf &lt;- tuneRF(dplyr::select(dw,-c(pa,fpa)), dw[, &#39;pa&#39;])</code></pre>
<pre><code>## mtry = 6  OOB error = 0.05558451 
## Searching left ...
## mtry = 3     OOB error = 0.05530499 
## 0.005028692 0.05 
## Searching right ...
## mtry = 12    OOB error = 0.05752334 
## -0.0348808 0.05</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-30-1.png" /><!-- --></p>
<p>We then find the best value (lowest error).</p>
<pre class="r"><code>trf</code></pre>
<pre><code>##    mtry   OOBError
## 3     3 0.05530499
## 6     6 0.05558451
## 12   12 0.05752334</code></pre>
<pre class="r"><code>mt &lt;- trf[which.min(trf[,2]), 1]
mt</code></pre>
<pre><code>## [1] 3</code></pre>
<p>We can then plug this value into the <code>randomForest()</code>
function in the argument <code>mtry =</code></p>
<pre class="r"><code>rrf &lt;- randomForest(dw[, 2:ncol(bfc)], dw[, &#39;pa&#39;], mtry=mt)
rrf</code></pre>
<pre><code>## 
## Call:
##  randomForest(x = dw[, 2:ncol(bfc)], y = dw[, &quot;pa&quot;], mtry = mt) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 3
## 
##           Mean of squared residuals: 0.0535169
##                     % Var explained: 66.13</code></pre>
<p><br></p>
<p class="comment">
<strong>Question 3</strong>: What did tuneRF help us find? What does the
value of <em>mt</em> represent?
</p>
<p><br></p>
<p>Here we show the variable importance plot for the model.</p>
<pre class="r"><code>varImpPlot(rrf)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-33-1.png" /><!-- --></p>
<div style="margin-bottom:25px;">

</div>
</div>
</div>
<div id="predict" class="section level2">
<h2><strong>Predict</strong></h2>
<p><br />
</p>
<p>We can use the random forest models we constructed above to make
predictions to any other place for which we have values for the
predictor variables. Our climate data is global so we could find
suitable places for bigfoot anywhere. But before we start placing
sasquatch anywhere we please, let’s first predict their locations in the
western portion of North America.</p>
<p>We need to establish the spatial extent of the observed western
locations to make predictions.</p>
<pre class="r"><code>ew &lt;- ext(vect(bf[bf[,1] &lt;= -102, 1:2]))
#get climate data across raster covering western extent
west &lt;- geodata::worldclim_global(&quot;bio&quot;, res=10, &quot;.&quot;)
window(west) &lt;- ew</code></pre>
<div style="margin-bottom:25px;">

</div>
<div id="regression-1" class="section level3">
<h3><strong>Regression</strong></h3>
<p><br />
</p>
<p>Let’s interpolate the probability that bigfoot will be present in a
location using the regression random forest model <em>rrf</em></p>
<pre class="r"><code>rp &lt;- predict(west, rrf, ext = ew, na.rm=TRUE)</code></pre>
<p>Show a raster map of the predicted range for the probability of our
species presence across the study area.</p>
<pre class="r"><code>plot(rp)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-36-1.png" /><!-- --></p>
<p>Note that the regression predictions are well-behaved, in the sense
that they are between 0 and 1. However, they are continuous within that
range, and if you wanted presence/absence, you would need a threshold
(i.e. if it is above the threshold, bigfoot is present, otherwise
absent). To get the optimal threshold, you would normally have a hold
out data set (see ISLR 8.3 for examples of using test and training
data), but here we use a training data for simplicity.</p>
<pre class="r"><code>#set seed for reproducibility since we are random sampling
set.seed(123)
i &lt;- sample(nrow(dw), 0.2 * nrow(dw))
test &lt;- dw[i,]
train &lt;- dw[-i,]</code></pre>
<p>We then predict.</p>
<pre class="r"><code>eva &lt;- pa_evaluate(predict(rrf, test[test$pa==1, ]), predict(rrf, test[test$pa==0, ]))
eva</code></pre>
<pre><code>## @stats
##    np   na prevalence auc  cor pcor   ODP
## 1 241 1003      0.194   1 0.96    0 0.806
## 
## @thresholds
##   max_kappa max_spec_sens no_omission equal_prevalence equal_sens_spec
## 1      0.44          0.44        0.44            0.194           0.494
## 
## @tr_stats
##     treshold kappa  CCR  TPR  TNR  FPR  FNR  PPP  NPP  MCR  OR
## 1          0     0 0.19    1    0    1    0 0.19  NaN 0.81 NaN
## 2          0  0.22 0.53    1 0.42 0.58    0 0.29    1 0.47 Inf
## 3          0  0.22 0.53    1 0.42 0.58    0 0.29    1 0.47 Inf
## 4        ...   ...  ...  ...  ...  ...  ...  ...  ...  ... ...
## 659        1  0.11 0.82 0.07    1    0 0.93    1 0.82 0.18 Inf
## 660        1  0.11 0.82 0.07    1    0 0.93    1 0.82 0.18 Inf
## 661        1     0 0.81    0    1    0    1  NaN 0.81 0.19 NaN</code></pre>
<p>To get a good threshold to determine presence/absence and plot the
prediction, we can use the “max specificity + sensitivity”
threshold.</p>
<pre class="r"><code>#uses the evaluation to find an optimal threshold
tr &lt;- threshold(eva)
tr</code></pre>
<pre><code>##   max_kappa max_spec_sens no_omission equal_prevalence equal_sens_spec
## 1 0.4401238     0.4401238   0.4401238         0.194123       0.4937809</code></pre>
<pre class="r"><code>#choosing max_spec_sens at the threshold value and plotting range as a binary
plot(rp &gt; tr$max_spec_sens)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-39-1.png" /><!-- --></p>
<p>The <em>max_spec_sens</em> represents the point at which the combined
sensitivity (true positive rate) and specificity (true negative rate)
are maximized.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="classification-1" class="section level3">
<h3><strong>Classification</strong></h3>
<p><br />
</p>
<p>We can also use the classification Random Forest model <em>crf</em>
to make a categorical present/absent prediction.</p>
<pre class="r"><code>rc &lt;- predict(west, crf, na.rm=TRUE)
plot(rc)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-40-1.png" /><!-- --></p>
<p>They are different because the classification used a threshold of
0.5, which is not necessarily appropriate.</p>
<p>You can get probabilities for the classes (in this case there are 2
classes, presence and absence, and we only plot presence).</p>
<pre class="r"><code>rc2 &lt;- predict(west, crf, type=&quot;prob&quot;, na.rm=TRUE)
#shows the probability of sightings in the U.S.
plot(rc2, 2)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-41-1.png" /><!-- --></p>
<div style="margin-bottom:25px;">

</div>
</div>
</div>
<div id="extrapolation" class="section level2">
<h2><strong>Extrapolation</strong></h2>
<p><br />
</p>
<p>Remember that we fitted our model using the Western portion of the
region. Now, let’s see if our model is general enough to predict the
distribution of the Eastern species. We’ll use the regression random
forest model to predict. We need to establish the spatial extent of the
observed eastern locations to make predictions, and get climate
data.</p>
<pre class="r"><code>ee &lt;- ext(vect(bf[bf[,1] &gt; -102, 1:2]))
east &lt;- geodata::worldclim_global(&quot;bio&quot;, res=10, &quot;.&quot;)
window(east) &lt;- ee</code></pre>
<p>Now we predict species location for the eastern location using our
random forest model <em>rrf</em>.</p>
<pre class="r"><code>rcusa &lt;- predict(east, rrf, ext=ee, na.rm=TRUE)</code></pre>
<p>Plot the predictions.</p>
<pre class="r"><code>plot(rcusa)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-44-1.png" /><!-- --></p>
<p>Plot the predictions with the observed locations</p>
<pre class="r"><code>plot(rcusa)
points(bf[bf[,1] &gt; -102,1:2], cex=.25)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-45-1.png" /><!-- --></p>
<p>Let’s get the predictions we got for the western and eastern sides
together.</p>
<pre class="r"><code>#predict for the entire region using rrf
allrusa &lt;- predict(wc, rrf, na.rm = TRUE)
#plot the predictions and observed points
plot(allrusa)
points(bf[,1:2], cex=.25)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-46-1.png" /><!-- --></p>
<p><br></p>
<p class="comment">
<strong>Question 4</strong>: Why would it be that the model does not
extrapolate well to eastern North America?
</p>
<p><br></p>
<p>We can also estimate range shifts due to climate change. In other
words, we can use the same model, but now extrapolate in time (and
space). We grab forecasted (future) versions of our climate
variables.</p>
<pre class="r"><code>fut &lt;- cmip6_world(&quot;CNRM-CM6-1&quot;, &quot;585&quot;, &quot;2061-2080&quot;, var=&quot;bio&quot;, res=10, path=&quot;.&quot;)
names(fut)</code></pre>
<pre><code>##  [1] &quot;bio01&quot; &quot;bio02&quot; &quot;bio03&quot; &quot;bio04&quot; &quot;bio05&quot; &quot;bio06&quot; &quot;bio07&quot; &quot;bio08&quot; &quot;bio09&quot;
## [10] &quot;bio10&quot; &quot;bio11&quot; &quot;bio12&quot; &quot;bio13&quot; &quot;bio14&quot; &quot;bio15&quot; &quot;bio16&quot; &quot;bio17&quot; &quot;bio18&quot;
## [19] &quot;bio19&quot;</code></pre>
<p>We need to convert the names of these variables to the same names
used in our random forest model.</p>
<pre class="r"><code>names(wc)</code></pre>
<pre><code>##  [1] &quot;wc2.1_10m_bio_1&quot;  &quot;wc2.1_10m_bio_2&quot;  &quot;wc2.1_10m_bio_3&quot;  &quot;wc2.1_10m_bio_4&quot; 
##  [5] &quot;wc2.1_10m_bio_5&quot;  &quot;wc2.1_10m_bio_6&quot;  &quot;wc2.1_10m_bio_7&quot;  &quot;wc2.1_10m_bio_8&quot; 
##  [9] &quot;wc2.1_10m_bio_9&quot;  &quot;wc2.1_10m_bio_10&quot; &quot;wc2.1_10m_bio_11&quot; &quot;wc2.1_10m_bio_12&quot;
## [13] &quot;wc2.1_10m_bio_13&quot; &quot;wc2.1_10m_bio_14&quot; &quot;wc2.1_10m_bio_15&quot; &quot;wc2.1_10m_bio_16&quot;
## [17] &quot;wc2.1_10m_bio_17&quot; &quot;wc2.1_10m_bio_18&quot; &quot;wc2.1_10m_bio_19&quot;</code></pre>
<pre class="r"><code>names(fut) &lt;- names(wc)</code></pre>
<p>We’ll predict for all of North America.</p>
<pre class="r"><code>window(fut) &lt;- ext_bf
pfut &lt;- predict(fut, rrf, na.rm=TRUE)
plot(pfut)</code></pre>
<p><img
src="regtrees_files/figure-html/unnamed-chunk-49-1.png" /><!-- --></p>
<p><br></p>
<p class="comment">
<strong>Question 5</strong>: Make a map to show where conditions are
improving for western bigfoot, and where they are not. Is the species
headed toward extinction?
</p>
<p><br></p>
<p>You’re done with the last lab of the class. Hooray!! <a
href="https://www.youtube.com/watch?v=bmZQpbNK7t4">Where’d all the time
go?</a></p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This
work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative
Commons Attribution-NonCommercial 4.0 International License</a>.</p>
<p>Website created and maintained by <a
href="https://nbrazil.faculty.ucdavis.edu/">Noli Brazil</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
