<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Kenji Tomari" />


<title>Lab Week 8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GEO 200CN: Winter 2020</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="hw_guidelines.html">Assignment Guidelines</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="tidyr.html">Intro to tidyverse</a>
    </li>
    <li>
      <a href="central.html">Sampling, CIs, CLT</a>
    </li>
    <li>
      <a href="hypothesis.html">Hypothesis Testing</a>
    </li>
    <li>
      <a href="spatialsf.html">Mapping in sf</a>
    </li>
    <li>
      <a href="pointpatterns.html">Point Pattern Analysis</a>
    </li>
    <li>
      <a href="spatialautocorrelation.html">Spatial Autocorrelation</a>
    </li>
    <li>
      <a href="linearregression.html">Linear Regression I</a>
    </li>
    <li>
      <a href="linearregression2.html">Linear Regression II</a>
    </li>
    <li>
      <a href="spatialreg.html">Spatial Regression</a>
    </li>
    <li>
      <a href="spatialheterogeneity.html">Spatial Heterogeneity</a>
    </li>
    <li>
      <a href="classification.html">Classification</a>
    </li>
    <li>
      <a href="resampling.html">Resampling and Selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Lab_Week1.html">Lab Lecture - 1</a>
    </li>
    <li>
      <a href="Lab_Week2.html">Lab Lecture - 2</a>
    </li>
    <li>
      <a href="Lab_Week3.html">Lab Lecture - 3</a>
    </li>
    <li>
      <a href="Lab_Week4.html">Lab Lecture - 4</a>
    </li>
    <li>
      <a href="Lab_Week5.html">Lab Lecture - 5</a>
    </li>
    <li>
      <a href="Lab_Week6.html">Lab Lecture - 6</a>
    </li>
    <li>
      <a href="Lab_Week7.html">Lab Lecture - 7</a>
    </li>
    <li>
      <a href="Lab_Week8.html">Lab Lecture - 8</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a></a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Lab Week 8</h1>
<h4 class="author">Kenji Tomari</h4>

</div>


<div id="classification" class="section level1">
<h1>Classification</h1>
<div id="question-1" class="section level2">
<h2>Question 1</h2>
<p>To create the confusion matrix, just use the code above the question, with the proper replacements, eg:</p>
<pre class="r"><code>pfit4 &lt;- predict(ols.fit2, type = &quot;response&quot;)
brfss16 &lt;- mutate(brfss16, 
                  pprob_ols = pfit4, 
                  pclass_ols = ifelse(pprob_ols &gt; 0.5, 1, 0))
table(brfss16$pclass_ols, 
      brfss16$badhealth)</code></pre>
<pre class="r"><code># Calculating the Percent Correctly Predicted for OLS Model

# NOTE
# I just take correctly predicted divided by total observations. 
# Then I multiply it by 100 to get a percentage.

# Predicted False and is Actually False
(length(which(brfss16$pclass_ols == 0 &amp; 
                brfss16$badhealth == 0)) +
   
   # Predicted True and is Actually True
   length(which(brfss16$pclass_ols == 1 &amp; 
                  brfss16$badhealth == 1))) /
  
  # Total Observations
  nrow(brfss16) *
  
  100 # percent</code></pre>
<p>Confusion matrices are discussed on page 147 of ISLR. (Look for the label “confusion matrix” on the right hand margin in grey font.)</p>
<p>Note that in answering this question you want to differentiate what “better prediction” means given various error rates. Overall error rate? Type I Error rate? Type II Error rate?</p>
<p>What about the overall error rate of OLS?</p>
<pre class="r"><code># Error Rate

# Predicted True when its Actually False
(length(which(brfss16$pclass_ols == 1 &amp; 
                brfss16$badhealth == 0)) +
   
   # Predicted FALSE when its Actually True
   length(which(brfss16$pclass_ols == 0 &amp; 
                  brfss16$badhealth == 1))) /
  
  # Total Observations
  nrow(brfss16) *
  
  100 # percent</code></pre>
</div>
<div id="question-2" class="section level2">
<h2>Question 2</h2>
<pre class="r"><code># DATA
brfss17 &lt;- read_csv(&quot;classification/brfss17.csv&quot;)

# Using 2016 Model on 2017 Data
pfit2017 &lt;- predict(logit4.fit, newdata = brfss17, type = &quot;response&quot;)

brfss17 &lt;- mutate(brfss17, 
                  pprob = pfit2017, 
                  pclass = ifelse(pprob &gt; 0.5, 1, 0))</code></pre>
<p>Now just use the above code from Question 1 to get the error rate (replacing <code>brfss16</code> with <code>brfss17</code>; and <code>pclass_ols</code> with <code>pclass</code>).</p>
</div>
<div id="question-3" class="section level2">
<h2>Question 3</h2>
<p>Use <code>table</code> and error rate code from Question 1, but replacing the appropriate arguments (i.e. <code>test$pclasslda</code> and <code>test$badhealth</code>)</p>
</div>
<div id="question-4" class="section level2">
<h2>Question 4</h2>
<pre class="r"><code>lda.pred_lc &lt;- predict(lda.fit, newdata = test.ca)
test.ca &lt;- mutate(test.ca, pclasslda = lda.pred_lc$class)</code></pre>
<pre class="r"><code># Which ones were correclty predicted?
test.ca &lt;- test.ca %&gt;%
  mutate(err_lda = case_when(
    pclasslda == whr ~ &quot;correctly_predicted&quot;,
    T ~ &quot;incorrectly_predicted&quot;
  ))

# Test Error Rate with future data.
nrow(test.ca[test.ca$err_lda == &quot;incorrectly_predicted&quot;,]) /
  
  # Total Observations
  nrow(test.ca) *
  
  100 # percent</code></pre>
</div>
<div id="question-5" class="section level2">
<h2>Question 5</h2>
<pre class="r"><code># Table of Error Rates by Class
test.ca %&gt;%
  mutate(err_lda = case_when(
    pclasslda == whr ~ 0,
    T ~ 1
  )) %&gt;%
  group_by(whr) %&gt;%
  summarize(total = n(),
            errors = sum(err_lda),
            error_rate = errors/total)</code></pre>
</div>
<div id="question-6" class="section level2">
<h2>Question 6</h2>
<pre class="r"><code># add knn predictions of classes to test.ca
test.ca &lt;- mutate(test.ca, pclassknn = knn.pred)</code></pre>
<pre class="r"><code># which are correctly predicted?
test.ca &lt;- test.ca %&gt;%
  mutate(err_knn = case_when(
    pclassknn == whr ~ &quot;correctly_predicted&quot;,
    T ~ &quot;incorrectly_predicted&quot;
  ))

# Test Error Rate
nrow(test.ca[test.ca$err_knn == &quot;incorrectly_predicted&quot;,]) /
  
  # Total Observations
  nrow(test.ca) *
  
  100 # percent</code></pre>
<pre class="r"><code># Table of Error Rates by Class
test.ca %&gt;%
  mutate(err_knn = case_when(
    pclassknn == whr ~ 0,
    T ~ 1
  )) %&gt;%
  group_by(whr) %&gt;%
  summarize(total = n(),
            errors = sum(err_knn),
            error_rate = errors/total)</code></pre>
</div>
</div>
<div id="resampling" class="section level1">
<h1>Resampling</h1>
<div id="question-1-1" class="section level2">
<h2>Question 1</h2>
<p>Note that the by running <code>st_crs()</code> on the <code>ca.temp.sf</code> dataset, we can find out that the map is in units of meters. So, in order to calculate the change in temperature, we need to multiply our coefficient by whatever 500 miles is in meters: approximately 804,672 meters.</p>
<p>Hint, what does 1 meter change in the Y coordinate yield in terms of temperature? You just multiply that value by 804,672 meters.</p>
</div>
<div id="question-2-1" class="section level2">
<h2>Question 2</h2>
<blockquote>
<p>“The cv.glm() function produces a list with several components. The two numbers in the delta vector contain the cross-validation results… The first is the standard k-fold CV estimate, as in (5.3). The second is a bias- corrected version.” (ISLR p192-194)</p>
</blockquote>
<p>Remember that LOOCV is a special case of k-fold Cross Validation (ISLR p181). (Hence the above quotation says k-fold CV estimate.) What is the delta vector/standard k-fold CV estimate then? In the case of LOOCV, its equation 5.1 on p. 179. You’ll note its the average Mean Squared Error (MSE). To get the Root Mean Squared Error (RMSE), one simply takes the squareroot the MSE. In this case, use the first delta value, the standard LOOCV estimate.</p>
<pre class="r"><code># get the data you want to use to model temperature by coordinates.
df2 &lt;- data.frame(st_coordinates(ca.temp.sf), temp = ca.temp.sf$temp)
# simple (OLS) linear model of temperature by coordinates
m2 &lt;- glm(temp ~ X+Y, data=df2)
# Use cv.glms() to calculate the LOOCV estimate.
# Note, we don&#39;t set the argument k:
# &quot;The default is to set K equal to the number of observations in data
# which gives the usual leave-one-out cross-validation.&quot;
cv_m2 &lt;- boot::cv.glm(data = df2, glmfit = m2)
# Standard k-fold CV estimate, or in this case, LOOCV estimate.
# To get the bias-corrected version, use cv_m2$delta[2]
cv_m2$delta[1]  # FYI, this is not the answer, there&#39;s one more step.</code></pre>
</div>
<div id="question-3-1" class="section level2">
<h2>Question 3</h2>
<p>ISLR discusses how to pick the best model in the section “6.1.3 Choosing the Optimal Model,” and discusses adjusted R^2 specifically on p212-3. Even if some of the math is above your head, the “intuition” paragraph should be helpful in answering this question. Also, here is some R code that might help you out.</p>
<pre class="r"><code># Which number of variables has the lowest Adjusted R^2?
which.min(regfit2.fwd.summary$adjr2)
# Which number of variables has the highest Adjusted R^2?
which.max(regfit2.fwd.summary$adjr2)
# Which variables? Just plug the NUMBER you want into:
# coef(regfit2.fwd, NUMBER)</code></pre>
</div>
<div id="question-4-1" class="section level2">
<h2>Question 4</h2>
<p>Use the below code to use Backward Stepwise Selection to get the best 33 variable models. Then use the same code you used for Question 3 to determine the best model based on adjusted R^2.</p>
<pre class="r"><code>regfit2.backward &lt;- regsubsets(physhlth ~ bmi + 
                                 race_eth + 
                                 agec + 
                                 male + 
                                 smoke + 
                                 educ + 
                                 inc + 
                                 employ + 
                                 marst + 
                                 ins + 
                                 bphigh + 
                                 toldhi + 
                                 cvdinfr + 
                                 cvdstrk + 
                                 asthma + 
                                 havarth + 
                                 diabete, 
                               data = brfss17, 
                               method = &quot;backward&quot;, 
                               nvmax = 33)</code></pre>
</div>
<div id="question-5-1" class="section level2">
<h2>Question 5</h2>
<p>If you look at p. 250 in ISLR, the authors demonstrate model selection using k-fold CV with their dataset. Where we found a 28-variable model, they found an 11-variable model was the best. Read the last paragraph on p. 250 carefully, and follow their example. You should, of course, replace the model specification (and other arguments for <code>regsubsets</code>) with the one we specify. Then run <code>coef</code> with 28 instead of 11 (as they do on the bottom of p. 250).</p>
</div>
<div id="question-6-1" class="section level2">
<h2>Question 6</h2>
<p>Do the above code starting with <code>set.seed(1234)</code> and replace the value for argument <code>alpha</code> with 1 for both <code>cv.glmnet</code> and <code>glmnet</code>.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
